<div class="game-layout">
  <!-- Winner -->
  @if (winner(); as w) {
  <game-winner [winner]="w" (reset)="resetGame()"></game-winner>
  }

  <!-- Información de la partida -->
  @if (publicState(); as st) {
  <game-info
    [state]="st"
    [historyCount]="history().length"
    (historyRequested)="openHistory()"
    (leaveRequested)="leaveGame()"
  ></game-info>

  <!-- Tablero de la partida -->
  <game-board [state]="st"></game-board>

  <!-- Mano del jugador -->
  <game-hand
    [hand]="hand()"
    [isMyTurn]="isMyTurn()"
    [roomId]="roomId"
    [publicState]="st"
    [gameEnded]="isGameEnded()"
  ></game-hand>
  }
  <!-- Home -->
  @else {
  <div class="game-empty">
    <h2>¿Partida finalizada?</h2>
    <p>
      Puedes regresar a la pantalla principal para crear o unirte a otra sala.
    </p>
    <button class="cta-button" (click)="goHome()">Empezar de nuevo</button>
  </div>
  }

  @if (showHistory()) {
  <div class="history-overlay" (click)="closeHistory()">
    <div class="history-modal" (click)="$event.stopPropagation()">
      <div class="history-header">
        <h3>Historial de movimientos</h3>
        <button
          type="button"
          class="history-close"
          aria-label="Cerrar historial"
          (click)="closeHistory()"
        >
          ✕
        </button>
      </div>

      @if (history().length) {
      <ul class="history-list">
        @for (entry of history(); track $index) {
        <li class="history-item">{{ entry }}</li>
        }
      </ul>
      }
      @else {
      <p class="history-empty">Aún no hay movimientos registrados.</p>
      }
    </div>
  </div>
  }

  <!-- Errores -->
  <game-error [error]="lastError()"></game-error>

  @if (confirmingLeave) {
  <div
    class="confirm-overlay"
    role="dialog"
    aria-modal="true"
    aria-labelledby="leave-confirm-title"
    aria-describedby="leave-confirm-description"
  >
    <div class="confirm-modal">
      <h3 id="leave-confirm-title">¿Salir de la partida?</h3>
      <p id="leave-confirm-description">
        Si abandonas la partida, perderás tu progreso actual. ¿Quieres volver a la lista
        de salas?
      </p>
      <div class="confirm-actions">
        <button type="button" class="confirm-cancel" (click)="cancelLeave()">
          Cancelar
        </button>
        <button type="button" class="confirm-accept" (click)="confirmLeave()">
          Salir
        </button>
      </div>
    </div>
  </div>
  }
</div>
