<div class="history-overlay" (click)="closeHistory()">
  <div class="history-modal" (click)="$event.stopPropagation()">
    <div class="history-header">
      <h3>Historial de movimientos</h3>
      <button type="button" class="history-close" aria-label="Cerrar historial" (click)="closeHistory()">
        ✕
      </button>
    </div>

    @if (history().length) {
    <ul class="history-list">
      @for (entry of parsedHistory(); track $index) {
      <li class="history-item">
        @if (entry.plainText) {
        {{ entry.plainText }}
        } @else {
        <span class="history-player">{{ entry.player }}</span>
        <span class="history-action">{{ entry.action }}</span>
        @if (entry.cardName) {
        <span class="history-card" [class]="'history-card--' + entry.cardColor">{{ entry.cardName }}</span>
        }
        @if (entry.parsedTarget && entry.parsedTarget.length > 0) {
        <span class="history-target">
          @for (segment of entry.parsedTarget; track $index) {
          @if (segment.isOrgan) {
          <span [class]="segment.colorClass">{{ segment.text }}</span>
          } @else {
          {{ segment.text }}
          }
          }
        </span>
        }
        }
      </li>
      }
    </ul>
    }
    @else {
    <p class="history-empty">Aún no hay movimientos registrados.</p>
    }
  </div>
</div>