<!-- <h3>Tu mano: {{ hand.length }} cartas</h3> -->

@if (hand.length) {
<div class="hand-panel" #handPanel [class.is-my-turn]="isMyTurn">
  @if (selectedCard) {
  <game-target-select
    [selectedCard]="selectedCard"
    [targetOptions]="targetOptions"
    [contagionAssignments]="contagionAssignments"
    [publicState]="publicState"
    [selectedTarget]="selectedTarget"
    [selectedTargetA]="selectedTargetA"
    [selectedTargetB]="selectedTargetB"
    [confirmDisabled]="!canConfirmSelection"
    [isMyTurn]="isMyTurn"
    (targetChange)="onTargetChange($event.value, $event.which)"
    (contagionTargetChange)="onContagionTargetChange($event.value, $event.index)"
    (confirm)="confirmPlayCard()"
    (cancel)="clearSelection()"
  />
  }

  <div
    class="hand-container"
    [class.is-my-turn]="isMyTurn"
    cdkDropList
    [id]="'handList-' + (apiPlayer.player()?.id || '')"
    [cdkDropListData]="hand"
    [cdkDropListConnectedTo]="boardIds()"
    (cdkDropListExited)="onExitHand($event)"
  >
    @for (card of hand; track card.id) {
    <app-hand-card
      [card]="card"
      [isSelected]="selectedCardsToDiscard.includes(card)"
      [isMyTurn]="isMyTurn"
      [infoOpen]="selectedCard?.id === card.id"
      (toggleSelect)="toggleDiscardSelection($event)"
      (play)="selectCardToPlay($event)"
      cdkDrag
      [cdkDragData]="card"
    ></app-hand-card>
    }
  </div>

  @if (selectedCardsToDiscard.length) {
  <button
    class="discard-btn"
    (click)="discardSelectedCards()"
    [disabled]="!isMyTurn || selectedCardsToDiscard.length === 0 || gameEnded"
  >
    Descartar seleccionadas ({{ selectedCardsToDiscard.length }})
  </button>
  }
</div>
<div
  class="hand-panel-spacer"
  aria-hidden="true"
  [style.height.px]="panelSpacerHeight"
></div>
<!-- Jugador no tiene cartas -->
} @else {
<div class="hand-empty">
  <p>Sin cartas</p>
</div>
}
